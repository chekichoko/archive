<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>캐릭터 아카이브</title>
    
    <!-- 1. 필수 도구 (스타일, 리액트) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 2. Firebase (가장 안정적인 호환 버전) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');
        
        :root {
            --sage-bg: #F1F5F2;
            --sage-primary: #98B0A0;
            --sage-text: #4D5A51;
            --sage-border: #E2EAE5;
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--sage-bg);
            color: var(--sage-text);
            margin: 0;
            padding: 0;
            font-size: 12px;
        }

        * { font-size: 12px; box-sizing: border-box; }
        
        /* 폰트 크기 수정: 제목을 훨씬 크게 키웠습니다 */
        .text-header { font-size: 40px !important; font-weight: 800 !important; letter-spacing: -0.02em; }
        .text-section { font-size: 18px !important; font-weight: 700 !important; }
        .text-card-title { font-size: 16px !important; font-weight: 700 !important; }

        .rounded-2xl { border-radius: 1rem !important; }
        .shadow-soft { box-shadow: 0 4px 20px -2px rgba(152, 176, 160, 0.15); }
        
        /* 연대기 라인 정렬 수정: 선과 원의 중심을 정확히 맞춤 */
        .timeline-container { position: relative; padding-left: 50px; }
        .timeline-line {
            position: absolute; 
            left: 24px; /* 선의 위치 */
            top: 0; 
            bottom: 0; 
            width: 2px; /* 선 두께 */
            background-color: #C8D1CC;
        }
        .timeline-dot {
            position: absolute; 
            left: 17px; /* (선 위치 24px) + (선 두께 2px / 2) - (원 크기 16px / 2) = 17px */
            top: 6px; 
            width: 16px; 
            height: 16px;
            background-color: white; 
            border: 3px solid var(--sage-primary); 
            border-radius: 50%; 
            z-index: 10;
        }

        #error-display { padding: 20px; color: red; display: none; background: white; border: 1px solid red; margin: 10px; }
        
        /* 버튼 클릭 효과 */
        button:active { transform: scale(0.98); }
    </style>
</head>
<body>
    <div id="error-display"></div>
    <div id="root"></div>

    <script>
        // 비상용 에러 표시기
        window.onerror = function(message, source, lineno, colno, error) {
            const display = document.getElementById('error-display');
            display.style.display = 'block';
            display.innerHTML = '<h3>서고를 여는 중 문제가 발생했습니다:</h3><p>' + message + '</p>';
        };
    </script>

    <script type="text/babel">
        // --- 아이콘 정의 ---
        const Icons = {
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Edit2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            Share2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>,
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Upload: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Clock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>,
            UserCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg>,
            History: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
            Check: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Copy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
        };

        const { useState, useEffect, useMemo } = React;

        // 데이터 관리자 (Firebase + LocalStorage 하이브리드)
        const DataService = {
            useFirebase: false,
            appId: 'my-archive',
            
            init: function(configStr, appId) {
                this.appId = appId || 'my-archive';
                try {
                    const config = JSON.parse(configStr || '{}');
                    if (config.apiKey && !firebase.apps.length) {
                        firebase.initializeApp(config);
                        this.useFirebase = true;
                    } else if (firebase.apps.length) {
                        this.useFirebase = true;
                    }
                } catch (e) {
                    console.warn("로컬 모드로 시작합니다:", e);
                    this.useFirebase = false;
                }
            },

            subscribe: function(callback) {
                if (this.useFirebase) {
                    try {
                        const db = firebase.firestore();
                        return db.collection('artifacts').doc(this.appId).collection('public').doc('data').collection('characters')
                            .onSnapshot(snapshot => {
                                const fetched = {};
                                snapshot.forEach(doc => {
                                    const d = doc.data();
                                    const group = d.mythName || '미분류';
                                    if (!fetched[group]) fetched[group] = [];
                                    fetched[group].push({ ...d, id: doc.id });
                                });
                                callback(fetched);
                            }, err => {
                                console.error("Firebase 실패, 로컬 사용:", err);
                                this.useFirebase = false; 
                                callback(this.getLocalData());
                            });
                    } catch (e) {
                        this.useFirebase = false;
                        callback(this.getLocalData());
                        return () => {};
                    }
                } else {
                    callback(this.getLocalData());
                    const handler = () => callback(this.getLocalData());
                    window.addEventListener('local-data-update', handler);
                    return () => window.removeEventListener('local-data-update', handler);
                }
            },

            getLocalData: function() {
                try {
                    const stored = localStorage.getItem(`archive_${this.appId}`);
                    return stored ? JSON.parse(stored) : {};
                } catch(e) { return {}; }
            },

            saveLocalData: function(data) {
                localStorage.setItem(`archive_${this.appId}`, JSON.stringify(data));
                window.dispatchEvent(new Event('local-data-update'));
            },

            addChar: async function(charData) {
                const id = Date.now().toString();
                if (this.useFirebase) {
                    await firebase.firestore().collection('artifacts').doc(this.appId).collection('public').doc('data').collection('characters').doc(id).set(charData);
                } else {
                    const current = this.getLocalData();
                    const group = charData.mythName || '미분류';
                    if (!current[group]) current[group] = [];
                    current[group].push({ ...charData, id });
                    this.saveLocalData(current);
                }
                return id;
            },

            updateChar: async function(id, newData) {
                if (this.useFirebase) {
                    await firebase.firestore().collection('artifacts').doc(this.appId).collection('public').doc('data').collection('characters').doc(id).set(newData);
                } else {
                    const current = this.getLocalData();
                    for (const group in current) {
                        const idx = current[group].findIndex(c => c.id === id);
                        if (idx !== -1) {
                            current[group].splice(idx, 1);
                            if (current[group].length === 0) delete current[group];
                            break;
                        }
                    }
                    const newGroup = newData.mythName || '미분류';
                    if (!current[newGroup]) current[newGroup] = [];
                    current[newGroup].push(newData);
                    this.saveLocalData(current);
                }
            },

            deleteChar: async function(id) {
                if (this.useFirebase) {
                    await firebase.firestore().collection('artifacts').doc(this.appId).collection('public').doc('data').collection('characters').doc(id).delete();
                } else {
                    const current = this.getLocalData();
                    for (const group in current) {
                        current[group] = current[group].filter(c => c.id !== id);
                        if (current[group].length === 0) delete current[group];
                    }
                    this.saveLocalData(current);
                }
            },

            importData: async function(importedData) {
                if (this.useFirebase) {
                    const batch = firebase.firestore().batch();
                    const collectionRef = firebase.firestore().collection('artifacts').doc(this.appId).collection('public').doc('data').collection('characters');
                    Object.values(importedData).flat().forEach(char => {
                        const ref = collectionRef.doc(char.id || Date.now().toString());
                        batch.set(ref, char);
                    });
                    await batch.commit();
                } else {
                    this.saveLocalData(importedData);
                }
            }
        };

        const App = () => {
            const [isReady, setIsReady] = useState(false);
            const [data, setData] = useState({});
            const [viewMode, setViewMode] = useState('list');
            const [appId, setAppId] = useState(window.__app_id || 'my-archive');
            const [tempAppId, setTempAppId] = useState('');

            // 입력 폼
            const [form, setForm] = useState({ mythName: '', name: '', summary: '' });
            
            // 상세/수정 상태
            const [selectedChar, setSelectedChar] = useState(null);
            const [isEditing, setIsEditing] = useState(false);
            const [editForm, setEditForm] = useState({});
            
            // 일지 상태
            const [logDate, setLogDate] = useState(new Date().toISOString().split('T')[0]);
            const [logText, setLogText] = useState('');
            const [copyStatus, setCopyStatus] = useState(false);

            // 초기화
            useEffect(() => {
                const init = async () => {
                    const initialAppId = window.__app_id || 'my-archive';
                    setAppId(initialAppId);
                    setTempAppId(initialAppId);
                    
                    DataService.init(window.__firebase_config, initialAppId);
                    
                    const unsubscribe = DataService.subscribe((newData) => {
                        setData(newData);
                        setIsReady(true);
                    });
                    return unsubscribe;
                };
                init();
            }, []);

            // --- 핸들러 ---

            const handleConnect = () => {
                if (!tempAppId.trim()) return;
                setAppId(tempAppId.trim());
                DataService.appId = tempAppId.trim();
                window.dispatchEvent(new Event('local-data-update'));
                setSelectedChar(null);
            };

            const handleAdd = async () => {
                if (!form.mythName || !form.name) {
                    alert("소속과 이름을 입력해주세요.");
                    return;
                }
                try {
                    await DataService.addChar({
                        ...form,
                        age: '', gender: '', size: '', alias: '', group: '', otherInfo: '',
                        hasTimeline: true, logs: [], 
                        createdAt: new Date().toLocaleDateString()
                    });
                    setForm({ mythName: '', name: '', summary: '' });
                } catch(e) { alert("저장 실패: " + e.message); }
            };

            const openDetails = (char) => {
                setSelectedChar(char);
                setEditForm({ ...char });
                setIsEditing(false);
            };

            const saveDetails = async () => {
                try {
                    await DataService.updateChar(selectedChar.id, editForm);
                    setIsEditing(false);
                    setSelectedChar({...editForm, id: selectedChar.id});
                } catch(e) { alert("저장 오류"); }
            };

            const addLog = async () => {
                if (!logText) return;
                const newLog = { id: Date.now().toString(), date: logDate, text: logText };
                const updatedLogs = [newLog, ...(selectedChar.logs || [])];
                const updatedChar = { ...selectedChar, logs: updatedLogs };
                await DataService.updateChar(selectedChar.id, updatedChar);
                setSelectedChar(updatedChar);
                setLogText('');
            };

            const deleteLog = async (logId) => {
                if(!confirm("이 기록을 삭제하시겠습니까?")) return;
                const updatedLogs = selectedChar.logs.filter(l => l.id !== logId);
                const updatedChar = { ...selectedChar, logs: updatedLogs };
                await DataService.updateChar(selectedChar.id, updatedChar);
                setSelectedChar(updatedChar);
            };

            const deleteChar = async () => {
                if(!confirm("정말 영구히 삭제하시겠습니까?")) return;
                await DataService.deleteChar(selectedChar.id);
                setSelectedChar(null);
            };

            const exportFile = () => {
                const blob = new Blob([JSON.stringify({ appId, data }, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `archive_${appId}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            const importFile = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = async (evt) => {
                    try {
                        const loaded = JSON.parse(evt.target.result);
                        if (!loaded.data) return;
                        await DataService.importData(loaded.data);
                        alert("불러오기 완료");
                    } catch(e) { alert("파일 오류"); }
                };
                reader.readAsText(file);
            };

            const globalTimeline = useMemo(() => {
                return Object.values(data).flat()
                    .filter(c => c.hasTimeline)
                    .flatMap(c => (c.logs || []).map(l => ({...l, charName: c.name, mythName: c.mythName})))
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
            }, [data]);

            if (!isReady) return (
                <div className="flex h-screen items-center justify-center bg-[#F1F5F2]">
                    <div className="text-center animate-pulse">
                        <p className="font-bold text-[#4D5A51] mb-2 text-header">서고를 열고 있습니다...</p>
                        <p className="text-xs opacity-50">잠시만 기다려 주세요.</p>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen p-6 md:p-12 max-w-7xl mx-auto">
                    <header className="text-center mb-10 border-b border-[#AAB8B0] pb-6">
                        <h1 className="text-header text-[#4D5A51] mb-2">캐릭터 아카이브</h1>
                        <p className="opacity-50 font-bold uppercase tracking-widest text-xs">통합 인물 기록 시스템</p>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-10">
                        <div className="bg-white p-4 rounded-2xl border border-[#E2EAE5] shadow-soft flex flex-col gap-2">
                            <div className="flex items-center gap-2 opacity-50 font-bold uppercase text-xs">
                                <Icons.Share2 /> 공유 식별자
                            </div>
                            <div className="flex gap-2">
                                <input type="text" value={tempAppId} onChange={e=>setTempAppId(e.target.value)} className="flex-1 bg-[#F8F9F8] p-2 rounded-2xl border border-[#E2EAE5] outline-none" placeholder="식별자" />
                                <button onClick={handleConnect} className="bg-[#98B0A0] text-white px-4 rounded-2xl font-bold hover:bg-[#7A9482] transition-all">이동</button>
                            </div>
                        </div>
                        <button onClick={exportFile} className="bg-white p-4 rounded-2xl border border-[#E2EAE5] shadow-soft font-bold hover:bg-[#F8F9F8] flex items-center justify-center gap-2 transition-all">
                            <Icons.Download /> 파일로 내보내기
                        </button>
                        <label className="bg-white p-4 rounded-2xl border border-[#E2EAE5] shadow-soft font-bold hover:bg-[#F8F9F8] flex items-center justify-center gap-2 cursor-pointer transition-all">
                            <Icons.Upload /> 파일 불러오기
                            <input type="file" onChange={importFile} className="hidden" />
                        </label>
                    </div>

                    <div className="flex justify-center gap-4 mb-10">
                        <button onClick={()=>setViewMode('list')} className={`px-10 py-3 rounded-2xl font-bold border transition-all ${viewMode==='list'?'bg-[#98B0A0] text-white':'bg-white text-[#4D5A51]'}`}>인물 목록</button>
                        <button onClick={()=>setViewMode('timeline')} className={`px-10 py-3 rounded-2xl font-bold border transition-all ${viewMode==='timeline'?'bg-[#98B0A0] text-white':'bg-white text-[#4D5A51]'}`}>전체 연대기</button>
                    </div>

                    {viewMode === 'list' && (
                        <div className="flex flex-col lg:flex-row gap-8">
                            <aside className="w-full lg:w-80 bg-white/50 p-6 border border-[#E2EAE5] rounded-2xl h-fit sticky top-8">
                                <h3 className="font-bold border-b border-[#AAB8B0] pb-3 mb-4 uppercase text-xs flex items-center gap-2 opacity-70">
                                    <Icons.Plus /> 신규 등록
                                </h3>
                                <div className="space-y-4">
                                    <input type="text" value={form.mythName} onChange={e=>setForm({...form, mythName:e.target.value})} className="w-full p-2.5 bg-white border border-[#E2EAE5] rounded-2xl outline-none" placeholder="소속 (예: 그리스 신화)" />
                                    <input type="text" value={form.name} onChange={e=>setForm({...form, name:e.target.value})} className="w-full p-2.5 bg-white border border-[#E2EAE5] rounded-2xl outline-none" placeholder="이름" />
                                    <textarea value={form.summary} onChange={e=>setForm({...form, summary:e.target.value})} className="w-full p-2.5 bg-white border border-[#E2EAE5] rounded-2xl outline-none resize-none h-20" placeholder="간단 요약"></textarea>
                                    <button onClick={handleAdd} className="w-full py-3 bg-[#98B0A0] text-white font-bold rounded-2xl hover:bg-[#7A9482] transition-all">등록하세요</button>
                                </div>
                            </aside>

                            <main className="flex-1 space-y-10">
                                {Object.keys(data).length === 0 ? <div className="text-center py-20 opacity-40 italic">등록된 인물이 없습니다.</div> :
                                Object.keys(data).sort().map(group => (
                                    <section key={group}>
                                        <h3 className="text-section mb-4 border-l-4 border-[#98B0A0] pl-3 text-[#4D5A51] uppercase">{group}</h3>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {data[group].map(char => (
                                                <div key={char.id} onClick={()=>{openDetails(char)}} className="bg-white p-5 rounded-2xl border border-[#E2EAE5] shadow-soft cursor-pointer hover:-translate-y-1 transition-all group flex flex-col">
                                                    <div className="flex justify-between mb-3 opacity-40">
                                                        {char.hasTimeline ? <Icons.Clock/> : <Icons.FileText/>}
                                                        <Icons.ChevronRight />
                                                    </div>
                                                    <h4 className="text-card-title mb-2 group-hover:text-[#6B8E23] transition-colors">{char.name}</h4>
                                                    <p className="opacity-70 line-clamp-2 leading-relaxed">{char.summary}</p>
                                                    {char.alias && <div className="mt-auto pt-3 text-[#98B0A0] font-bold opacity-80 uppercase tracking-wider">{char.alias}</div>}
                                                </div>
                                            ))}
                                        </div>
                                    </section>
                                ))}
                            </main>
                        </div>
                    )}

                    {viewMode === 'timeline' && (
                        <div className="max-w-3xl mx-auto bg-white p-10 rounded-2xl border border-[#E2EAE5] shadow-soft relative">
                            <h2 className="text-center font-bold text-xl mb-10 uppercase tracking-widest text-[#4A5D50]">통합 연대기</h2>
                            <div className="timeline-container space-y-10">
                                <div className="timeline-line"></div>
                                {globalTimeline.map(log => (
                                    <div key={log.id} className="relative">
                                        <div className="timeline-dot"></div>
                                        <div className="font-bold opacity-40 mb-1 uppercase text-xs">{log.date}</div>
                                        <div className="font-bold mb-2 text-base">{log.charName} <span className="opacity-40 text-xs ml-1">[{log.mythName}]</span></div>
                                        <div className="bg-[#F9FBF9] p-4 rounded-2xl border border-[#E2EAE5] leading-relaxed">{log.text}</div>
                                    </div>
                                ))}
                                {globalTimeline.length === 0 && <div className="text-center opacity-40 py-10">기록된 연대기가 없습니다.</div>}
                            </div>
                        </div>
                    )}

                    {selectedChar && (
                        <div className="fixed inset-0 z-50 bg-[#F1F5F2] overflow-y-auto p-4 md:p-10 no-scrollbar">
                            <div className="max-w-6xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden min-h-full md:min-h-0 border border-[#E2EAE5]">
                                <header className="p-8 border-b border-[#E2EAE5] flex justify-between items-center bg-white sticky top-0 z-20">
                                    <div className="flex items-center gap-4">
                                        <h2 className="text-header text-[#4D5A51]">{selectedChar.name}</h2>
                                        <span className="px-3 py-1 border border-[#98B0A0] text-[#98B0A0] rounded-2xl font-bold text-xs uppercase">{selectedChar.hasTimeline ? '연대기 모드' : '정보 모드'}</span>
                                    </div>
                                    <button onClick={()=>setSelectedChar(null)} className="px-6 py-2 bg-[#98B0A0] text-white font-bold rounded-2xl hover:bg-[#7A9482] transition-all">닫기</button>
                                </header>

                                <div className="p-8 flex flex-col lg:flex-row gap-10">
                                    <aside className="w-full lg:w-[420px] space-y-6">
                                        <div className="flex justify-between items-center border-b border-[#E2EAE5] pb-2">
                                            <h3 className="font-bold opacity-50 uppercase text-xs flex items-center gap-2"><Icons.UserCircle/> 고정 정보</h3>
                                            <button onClick={()=>setIsEditing(!isEditing)} className="font-bold text-xs border-b border-[#4D5A51] text-[#4D5A51]">{isEditing ? '취소' : '편집'}</button>
                                        </div>

                                        {isEditing ? (
                                            <div className="space-y-3 bg-[#F9FBF9] p-6 rounded-2xl border border-[#E2EAE5]">
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div><label className="block font-bold opacity-40 mb-1">소속</label><input type="text" value={editForm.mythName} onChange={e=>setEditForm({...editForm, mythName:e.target.value})} className="w-full p-2 bg-white border border-[#E2EAE5] rounded-2xl outline-none"/></div>
                                                    <div><label className="block font-bold opacity-40 mb-1">이름</label><input type="text" value={editForm.name} onChange={e=>setEditForm({...editForm, name:e.target.value})} className="w-full p-2 bg-white border border-[#E2EAE5] rounded-2xl outline-none"/></div>
                                                    <div><label className="block font-bold opacity-40 mb-1">나이</label><input type="text" value={editForm.age} onChange={e=>setEditForm({...editForm, age:e.target.value})} className="w-full p-2 bg-white border border-[#E2EAE5] rounded-2xl outline-none"/></div>
                                                    <div><label className="block font-bold opacity-40 mb-1">성별</label><input type="text" value={editForm.gender} onChange={e=>setEditForm({...editForm, gender:e.target.value})} className="w-full p-2 bg-white border border-[#E2EAE5] rounded-2xl outline-none"/></div>
                                                    <div><label className="block font-bold opacity-40 mb-1">크기</label><input type="text" value={editForm.size} onChange={e=>setEditForm({...editForm, size:e.target.value})} className="w-full p-2 bg-white border border-[#E2EAE5] rounded-2xl outline-none"/></div>
                                                    <div><label className="block font-bold opacity-40 mb-1">별칭</label><input type="text" value={editForm.alias} onChange={e=>setEditForm({...editForm, alias:e.target.value})} className="w-full p-2 bg-white border border-[#E2EAE5] rounded-2xl outline-none"/></div>
                                                </div>
                                                <div><label className="block font-bold opacity-40 mb-1">소속 단체</label><input type="text" value={editForm.group} onChange={e=>setEditForm({...editForm, group:e.target.value})} className="w-full p-2 bg-white border border-[#E2EAE5] rounded-2xl outline-none"/></div>
                                                <div><label className="block font-bold opacity-40 mb-1">상세 설정</label><textarea value={editForm.otherInfo} onChange={e=>setEditForm({...editForm, otherInfo:e.target.value})} className="w-full p-2 bg-white border border-[#E2EAE5] rounded-2xl outline-none h-32"></textarea></div>
                                                <div className="flex items-center gap-4 py-2">
                                                    <label className="font-bold opacity-40">연대기 기능</label>
                                                    <button onClick={()=>setEditForm({...editForm, hasTimeline:!editForm.hasTimeline})} className={`px-4 py-1 rounded-2xl font-bold border ${editForm.hasTimeline?'bg-[#98B0A0] text-white':'bg-white'}`}>{editForm.hasTimeline ? '사용' : '미사용'}</button>
                                                </div>
                                                <div className="flex gap-2 pt-4">
                                                    <button onClick={saveDetails} className="flex-1 py-3 bg-[#98B0A0] text-white font-bold rounded-2xl hover:bg-[#7A9482] transition-all">저장하세요</button>
                                                    <button onClick={deleteChar} className="px-4 py-3 border border-red-200 text-red-400 font-bold rounded-2xl hover:bg-red-50 transition-all">삭제</button>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="space-y-6 bg-white rounded-2xl">
                                                <div className="grid grid-cols-2 gap-y-6 gap-x-4 text-center">
                                                    <div><span className="block font-bold opacity-30 mb-1">나이</span><span className="font-bold text-lg">{selectedChar.age || '-'}</span></div>
                                                    <div><span className="block font-bold opacity-30 mb-1">성별</span><span className="font-bold text-lg">{selectedChar.gender || '-'}</span></div>
                                                    <div><span className="block font-bold opacity-30 mb-1">크기</span><span className="font-bold text-lg">{selectedChar.size || '-'}</span></div>
                                                    <div><span className="block font-bold opacity-30 mb-1">별칭</span><span className="font-bold text-lg">{selectedChar.alias || '-'}</span></div>
                                                    <div className="col-span-2 border-t border-[#E2EAE5] pt-4"><span className="block font-bold opacity-30 mb-1">소속 단체</span><span className="font-bold">{selectedChar.group || '-'}</span></div>
                                                </div>
                                                <div className="pt-4 border-t border-[#E2EAE5]">
                                                    <label className="block font-bold opacity-30 mb-2 text-center uppercase tracking-widest">상세 설정 노트</label>
                                                    <div className="bg-[#F9FBF9] p-6 rounded-2xl leading-loose text-justify shadow-inner min-h-[150px] whitespace-pre-wrap">{selectedChar.otherInfo || '상세 정보가 없습니다.'}</div>
                                                </div>
                                            </div>
                                        )}
                                    </aside>

                                    <main className="flex-1">
                                        {selectedChar.hasTimeline ? (
                                            <div className="max-w-2xl mx-auto space-y-10">
                                                <div className="bg-white p-8 rounded-2xl border border-[#E2EAE5] shadow-soft">
                                                    <h3 className="font-bold opacity-50 mb-6 flex items-center gap-2 text-xs uppercase"><Icons.Clock/> 사건 기록</h3>
                                                    <div className="flex flex-col gap-4">
                                                        <div className="flex gap-4">
                                                            <input type="date" value={logDate} onChange={e=>setLogDate(e.target.value)} className="w-1/3 p-3 bg-[#F9FBF9] border border-[#E2EAE5] rounded-2xl outline-none" />
                                                            <input type="text" value={logText} onChange={e=>setLogText(e.target.value)} className="flex-1 p-3 bg-[#F9FBF9] border border-[#E2EAE5] rounded-2xl outline-none" placeholder="사건 내용" />
                                                        </div>
                                                        <button onClick={addLog} className="w-full py-3 bg-[#98B0A0] text-white font-bold rounded-2xl shadow-md hover:bg-[#7A9482] transition-all">기록하기</button>
                                                    </div>
                                                </div>

                                                <div className="timeline-container space-y-8 pb-20">
                                                    {(selectedChar.logs||[]).length > 0 && <div className="timeline-line"></div>}
                                                    {(selectedChar.logs||[]).map(log => (
                                                        <div key={log.id} className="relative">
                                                            <div className="timeline-dot"></div>
                                                            <div className="pl-8 flex justify-between items-start mb-2">
                                                                <span className="font-bold opacity-40 uppercase tracking-widest">{log.date}</span>
                                                                <button onClick={()=>deleteLog(log.id)} className="opacity-20 hover:text-red-500 transition-colors"><Icons.Trash2 size={14}/></button>
                                                            </div>
                                                            <div className="pl-8 bg-white p-5 rounded-2xl border border-[#E2EAE5] shadow-sm leading-relaxed text-justify">{log.text}</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="h-full flex flex-col items-center justify-center opacity-20 border-2 border-dashed border-[#AAB8B0] rounded-2xl p-20 bg-[#F9FBF9]">
                                                <Icons.History size={80} />
                                                <p className="mt-6 font-bold text-center">연대기 기능이 꺼져 있습니다.</p>
                                            </div>
                                        )}
                                    </main>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


